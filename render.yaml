services:
  # --- 1. Gateway ---
  - type: web
    name: msvc-gateway
    runtime: docker
    repo: https://github.com/DomingoAndres/AppAgendita-Backend
    branch: render-test
    rootDir: .
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: free
    envVars:
      - key: JAR_NAME       # <--- LA SOLUCIÓN
        value: msvc-gateway # Nombre del jar sin .jar
      - key: PORT
        value: 8080
      - key: EUREKA_CLIENT_ENABLED
        value: false
      - key: SPRING_CLOUD_CONFIG_ENABLED
        value: false

  # --- 2. Microservicio de Usuario ---
  - type: web
    name: msvc-user
    runtime: docker
    repo: https://github.com/DomingoAndres/AppAgendita-Backend
    branch: render-test
    rootDir: .
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: free
    envVars:
      - key: JAR_NAME       # <--- LA SOLUCIÓN
        value: msvc-user
      - key: PORT
        value: 8080
      - key: SPRING_CLOUD_CONFIG_ENABLED
        value: false
      - key: DB_HOST
        fromDatabase:
          name: agendita-db
          property: host
      - key: DB_NAME
        fromDatabase:
          name: agendita-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: agendita-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: agendita-db
          property: password

  # --- 3. Microservicio de Tareas ---
  - type: web
    name: msvc-task
    runtime: docker
    repo: https://github.com/DomingoAndres/AppAgendita-Backend
    branch: render-test
    rootDir: .
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: free
    envVars:
      - key: JAR_NAME       # <--- LA SOLUCIÓN
        value: msvc-task
      - key: PORT
        value: 8080
      - key: SPRING_CLOUD_CONFIG_ENABLED
        value: false
      - key: DB_HOST
        fromDatabase:
          name: agendita-db
          property: host
      - key: DB_NAME
        fromDatabase:
          name: agendita-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: agendita-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: agendita-db
          property: password

  # --- 4. Microservicio de Notas ---
  - type: web
    name: msvc-note
    runtime: docker
    repo: https://github.com/DomingoAndres/AppAgendita-Backend
    branch: render-test
    rootDir: .
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: free
    envVars:
      - key: JAR_NAME       # <--- LA SOLUCIÓN
        value: msvc-note
      - key: PORT
        value: 8080
      - key: SPRING_CLOUD_CONFIG_ENABLED
        value: false
      - key: DB_HOST
        fromDatabase:
          name: agendita-db
          property: host
      - key: DB_NAME
        fromDatabase:
          name: agendita-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: agendita-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: agendita-db
          property: password

  # --- 5. Microservicio de Eventos ---
  - type: web
    name: msvc-event
    runtime: docker
    repo: https://github.com/DomingoAndres/AppAgendita-Backend
    branch: render-test
    rootDir: .
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: free
    envVars:
      - key: JAR_NAME       # <--- LA SOLUCIÓN
        value: msvc-event
      - key: PORT
        value: 8080
      - key: SPRING_CLOUD_CONFIG_ENABLED
        value: false
      - key: DB_HOST
        fromDatabase:
          name: agendita-db
          property: host
      - key: DB_NAME
        fromDatabase:
          name: agendita-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: agendita-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: agendita-db
          property: password

# --- Base de Datos Compartida ---
databases:
  - name: agendita-db
    plan: free
    databaseName: agendita_root_db
    user: agendita_admin